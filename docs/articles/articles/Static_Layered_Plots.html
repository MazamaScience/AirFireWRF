<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Static Layered Plots • AirFireWRF</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Static Layered Plots">
<meta property="og:description" content="AirFireWRF">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">AirFireWRF</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.15</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/WRFmet.html">AirFireWRF</a>
    </li>
    <li>
      <a href="../../articles/articles/Saving_Data_Subsets.html">Saving Data Subsets</a>
    </li>
    <li>
      <a href="../../articles/articles/Static_Layered_Plots.html">Static Layered Plots</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/AirFireWRF/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Static_Layered_Plots_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Static Layered Plots</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">8/11/2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirFireWRF/blob/master/vignettes/articles/Static_Layered_Plots.Rmd"><code>vignettes/articles/Static_Layered_Plots.Rmd</code></a></small>
      <div class="hidden name"><code>Static_Layered_Plots.Rmd</code></div>

    </div>

    
    
<p>This article will walk through the process of plotting meteorological data using the AirFireWRF package.</p>
<div id="plotting-outline" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-outline" class="anchor"></a>Plotting Outline</h2>
<p>The Weather Research and Forecast (WRF) model is used to predict meteorological conditions over the Earth. These forecasts output grids of spatial points that that track variables like temperature, wind velocity, moisture levels, and many others. The AirFireWRF package provides an easy way to convert these collections of points into Raster objects so they can then be plotted with additional features. For instance, you can build a plot with a Raster for a WRF variable, a vector field for WRF vector components, and layers for spatial points and polygons. Let’s outline an example plot to showcase these different features.</p>
</div>
<div id="wrf-plotting-example" class="section level2">
<h2 class="hasAnchor">
<a href="#wrf-plotting-example" class="anchor"></a>WRF Plotting Example</h2>
<p>Our plot will cover Washington, Oregon, and Idaho on July 15, 2020, and will include the following layers:</p>
<ol style="list-style-type: decimal">
<li>A raster for temperature</li>
<li>A vector field for wind velocity</li>
<li>Spatial points for air quality monitors</li>
<li>Spatial polygons for state boundaries</li>
</ol>
<p>To start with, let’s load the temperature and wind velocity data from a July 15, 2020 WRF file (recent runs available <a href="http://m2.airfire.org/PNW/">here</a>). WRF data takes up quite a bit of space, so this article will load in an example dataset provided in the package. If we were to use a WRF NetCDF file already on our machine though, we would first define a grid and then use <code><a href="../../reference/wrf_load.html">wrf_load()</a></code> to create RasterBricks for our desired variables. For temperature we would specify the ‘T2’ WRF variable which gives us a RasterBrick with a single layer. For wind velocity, we would specify the ‘U10’ and ‘V10’ WRF variables (North &amp; East vector components) which give us a RasterBrick with two layers. Here is an example of what that would look like:</p>
<pre><code><a href="https://rdrr.io/pkg/AirFireWRF/man">library(AirFireWRF)

# Define a common Raster grid
xlim &lt;- c(-125, -111)
ylim &lt;- c(42, 49)
res &lt;- 0.06

# A RasterBrick with a single layer for elevation
tempRaster &lt;- wrf_load(
  localPath = '~/Data/WRF/wrfout_d3-2020071512-f07-0000.nc',
  varName = 'T2',
  xlim = xlim,
  ylim = ylim,
  res = res
)

# A RasterBrick with layers for both U and V wind vector components
windRaster &lt;- wrf_load(
  localPath = '~/Data/WRF/wrfout_d3-2020071512-f07-0000.nc',
  varName = c('U10', 'V10'),
  xlim = xlim,
  ylim = ylim,
  res = res
)</a></code></pre>
<p>But for now, let’s use an example Raster already included in the package:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">AirFireWRF</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)

<span class="no">raster</span> <span class="kw">&lt;-</span> <span class="kw pkg">AirFireWRF</span><span class="kw ns">::</span><span class="no"><a href="../../reference/example_PNW.html">example_PNW</a></span>

<span class="co"># Extract the underlying grid these Rasters are using</span>
<span class="no">extent</span> <span class="kw">&lt;-</span> <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span>(<span class="no">raster</span>)
<span class="no">xlim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">extent</span>@<span class="kw">xmin</span>), <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">extent</span>@<span class="kw">xmax</span>))
<span class="no">ylim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">extent</span>@<span class="kw">ymin</span>), <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">extent</span>@<span class="kw">ymax</span>))
<span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/resolution.html">res</a></span>(<span class="no">raster</span>)), <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p>We can make some quick visualizations of these Rasters using the RasterVis package. For temperature, we can use the <code>levelPlot()</code> function:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="kw pkg">rasterVis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span>(<span class="no">raster</span><span class="kw">[[</span><span class="st">"TSK"</span>]], <span class="kw">main</span> <span class="kw">=</span> <span class="st">'Temperature (K)'</span>, <span class="kw">margin</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/levelPlot-1.png" width="768"></p>
<p>And for wind velocity, we can use the North and East vector components in <code>vectorplot()</code> to make a vector field:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="kw pkg">rasterVis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/vectorplot.html">vectorplot</a></span>(
  <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span>(<span class="no">raster</span><span class="kw">[[</span><span class="st">"U10"</span>]], <span class="no">raster</span><span class="kw">[[</span><span class="st">"V10"</span>]]),
  <span class="kw">isField</span> <span class="kw">=</span> <span class="st">'dXY'</span>,
  <span class="kw">narrows</span> <span class="kw">=</span> <span class="fl">500</span>,
  <span class="kw">length</span> <span class="kw">=</span> <span class="fl">0.05</span>,
  <span class="kw">aspX</span> <span class="kw">=</span> <span class="fl">0.07</span>,
  <span class="kw">aspY</span> <span class="kw">=</span> <span class="fl">0.07</span>,
  <span class="kw">col.arrows</span> <span class="kw">=</span> <span class="st">'white'</span>
)</pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/vectorPlot-1.png" width="768"></p>
<p>It would be nice if we could combine these plots along with additional features like state borders and points for air quality monitors. We can do this using AirFireWRF’s layered plotting capabilities. AirFireWRF provides a several helpful <code>layer_*()</code> functions which produce GGPlot elements much like <code>geom_*()</code>. The layers currently available are:</p>
<ul>
<li><code>layer_raster</code></li>
<li><code>layer_vectorField</code></li>
<li><code>layer_points</code></li>
<li><code>layer_states</code></li>
</ul>
<p>Integrating our meteorological data with GGPlot can make our visualizations much more flexible. We can make a plot by creating an empty GGplot object, then “+” on our <code>layer_*</code> elements and any other GGplot elements we might want, such as labels, color palettes, grid limits, etc.</p>
<p>Let’s draw the temperature Raster again using this approach:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">temp_plot</span> <span class="kw">&lt;-</span>
  <span class="co"># Define an empty plotting space</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="co"># Draw the temperature raster</span>
  <span class="fu"><a href="../../reference/layer_raster.html">layer_raster</a></span>(
    <span class="kw">raster</span> <span class="kw">=</span> <span class="no">raster</span><span class="kw">[[</span><span class="st">"TSK"</span>]]
  ) +
  <span class="co"># Crop the plot area</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>(
    <span class="kw">ratio</span> <span class="kw">=</span> <span class="fl">1.4</span>,
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
  ) +
  <span class="co"># Set raster color palette</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span>(
    <span class="kw">colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'violet'</span>, <span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>),
    <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">'transparent'</span>
  ) +
  <span class="co"># Set the plot labels</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">'WRF Temperature'</span>,
    <span class="kw">x</span> <span class="kw">=</span> <span class="st">'Longitude'</span>,
    <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Latitude'</span>,
    <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'Temp (K)'</span>
  )

<span class="no">temp_plot</span></pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/temperature_plot-1.png" width="768"></p>
<p>Now we can start adding additional layers to help understand this information. Let’s draw the same plot, but now with state borders:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">temp_state_plot</span> <span class="kw">&lt;-</span>
  <span class="no">temp_plot</span> +
  <span class="co"># Draw state borders</span>
  <span class="fu"><a href="../../reference/layer_states.html">layer_states</a></span>(
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>,
    <span class="kw">color</span> <span class="kw">=</span> <span class="st">'red'</span>
  )

<span class="no">temp_state_plot</span></pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/temperature_state_plot-1.png" width="768"></p>
<p>That’s a little better! Let’s also make our wind Rasters a bit more helpful by using them to draw vector arrows with <code><a href="../../reference/layer_vectorField.html">layer_vectorField()</a></code>. This function assumes the provided RasterBrick has two layers representing the U (North) and V (East) components of vectors:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">temp_state_wind_plot</span> <span class="kw">&lt;-</span>
  <span class="no">temp_state_plot</span> +
  <span class="co"># Draw the wind vector field</span>
  <span class="fu"><a href="../../reference/layer_vectorField.html">layer_vectorField</a></span>(
    <span class="kw">raster</span> <span class="kw">=</span> <span class="no">raster</span>,
    <span class="kw">uName</span> <span class="kw">=</span> <span class="st">"U10"</span>,
    <span class="kw">vName</span> <span class="kw">=</span> <span class="st">"V10"</span>,
    <span class="kw">arrowCount</span> <span class="kw">=</span> <span class="fl">500</span>,
    <span class="kw">arrowColor</span> <span class="kw">=</span> <span class="st">'black'</span>,
    <span class="kw">arrowScale</span> <span class="kw">=</span> <span class="fl">0.07</span>,
    <span class="kw">arrowHead</span> <span class="kw">=</span> <span class="fl">0.06</span>,
    <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.8</span>
  )

<span class="no">temp_state_wind_plot</span></pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/temperature_state_wind_plot-1.png" width="768"></p>
<p>Finally, lets plot some monitor air quality readings. We can use the PWFSLSmoke package to collect the July 15, 2020 PM 2.5 readings for monitors in Washington, Oregon, and Idaho:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PWFSLSmoke</span>)

<span class="co"># Load monitor data</span>
<span class="no">monitors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_load.html">monitor_load</a></span>(
  <span class="kw">startdate</span> <span class="kw">=</span> <span class="st">"2020-07-15"</span>,
  <span class="kw">enddate</span> <span class="kw">=</span> <span class="st">"2020-07-16"</span>
) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_subset.html">monitor_subset</a></span>(<span class="kw">stateCodes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'WA'</span>, <span class="st">'OR'</span>, <span class="st">'ID'</span>))

<span class="co"># Find each monitor's average reading from July 15, 2020 </span>
<span class="co">#means &lt;- monitor_getDailyMean(monitors, startdate = "2020-07-15")</span>
<span class="no">means</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_dailyStatistic.html">monitor_dailyStatistic</a></span>(<span class="no">monitors</span>, <span class="kw">minHours</span> <span class="kw">=</span> <span class="fl">16</span>)

<span class="co"># Link monitor coordinates and their averages for July 15, 2020</span>
<span class="no">monitorPoints</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="no">means</span>$<span class="no">meta</span>$<span class="no">longitude</span>,
  <span class="kw">y</span> <span class="kw">=</span> <span class="no">means</span>$<span class="no">meta</span>$<span class="no">latitude</span>,
  <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">means</span>$<span class="no">data</span>[<span class="fl">1</span>, <span class="fl">2</span>:<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span>(<span class="no">means</span>$<span class="no">data</span>)])
)

<span class="no">temp_state_monitors_wind_plot</span> <span class="kw">&lt;-</span>
  <span class="no">temp_state_wind_plot</span> +
  <span class="co"># Draw the monitor points</span>
  <span class="fu"><a href="../../reference/layer_points.html">layer_points</a></span>(
    <span class="kw">points</span> <span class="kw">=</span> <span class="no">monitorPoints</span>
  ) +
  <span class="co"># Set the point color palette</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradient</a></span>(
    <span class="kw">low</span> <span class="kw">=</span> <span class="st">'white'</span>,
    <span class="kw">high</span> <span class="kw">=</span> <span class="st">'black'</span>,
    <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">'transparent'</span>
  ) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">color</span> <span class="kw">=</span> <span class="st">'PM 2.5'</span>
  )

<span class="no">temp_state_monitors_wind_plot</span></pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/temperature_state_monitor_wind_plot-1.png" width="768"></p>
<p>I don’t want the monitor points to cover up the wind vectors though. To fix this I could simply go build off the previous <code>temp_state_plot</code> like:</p>
<pre><code>temp_state_monitors_wind_plot &lt;-
  temp_state_plot +
  # Draw the monitor points
  layer_points(
    points = monitorPoints
  ) +
  # Draw the wind vector field
  layer_vectorField(
    raster = raster,
    uName = "U10",
    vName = "V10",
    arrowCount = 500,
    arrowColor = 'black',
    arrowScale = 0.08,
    arrowHead = 0.06,
    alpha = 0.8
  )</code></pre>
<p>…but let’s take a step back and see what it would look like to create this entire plot at once:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">wrfMap</span> <span class="kw">&lt;-</span>
  <span class="co"># Define an empty plotting space</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="co"># Draw the temperature raster</span>
  <span class="fu"><a href="../../reference/layer_raster.html">layer_raster</a></span>(
    <span class="kw">raster</span> <span class="kw">=</span> <span class="no">raster</span><span class="kw">[[</span><span class="st">"TSK"</span>]]
  ) +
  <span class="co"># Then draw state borders</span>
  <span class="fu"><a href="../../reference/layer_states.html">layer_states</a></span>(
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>,
    <span class="kw">color</span> <span class="kw">=</span> <span class="st">'red'</span>
  ) +
  <span class="co"># Then draw the points</span>
  <span class="fu"><a href="../../reference/layer_points.html">layer_points</a></span>(
    <span class="kw">points</span> <span class="kw">=</span> <span class="no">monitorPoints</span>
  ) +
  <span class="co"># Then draw the wind vector field</span>
  <span class="fu"><a href="../../reference/layer_vectorField.html">layer_vectorField</a></span>(
    <span class="kw">raster</span> <span class="kw">=</span> <span class="no">raster</span>,
    <span class="kw">uName</span> <span class="kw">=</span> <span class="st">"U10"</span>,
    <span class="kw">vName</span> <span class="kw">=</span> <span class="st">"V10"</span>,
    <span class="kw">arrowCount</span> <span class="kw">=</span> <span class="fl">500</span>,
    <span class="kw">arrowColor</span> <span class="kw">=</span> <span class="st">'black'</span>,
    <span class="kw">arrowScale</span> <span class="kw">=</span> <span class="fl">0.08</span>,
    <span class="kw">arrowHead</span> <span class="kw">=</span> <span class="fl">0.06</span>,
    <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.8</span>
  ) +
  <span class="co"># Crop the plot area</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>(
    <span class="kw">ratio</span> <span class="kw">=</span> <span class="fl">1.4</span>,
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
  ) +
  <span class="co"># Set raster color palette</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span>(
    <span class="kw">colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'violet'</span>, <span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>),
    <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">'transparent'</span>
  ) +
  <span class="co"># Set the point color palette</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradient</a></span>(
    <span class="kw">low</span> <span class="kw">=</span> <span class="st">'white'</span>,
    <span class="kw">high</span> <span class="kw">=</span> <span class="st">'black'</span>,
    <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">'transparent'</span>
  ) +
  <span class="co"># Set the plot labels</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Elevation &amp; Wind Map'</span>,
    <span class="kw">x</span> <span class="kw">=</span> <span class="st">'Longitude'</span>,
    <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Latitude'</span>,
    <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'Temp (K)'</span>,
    <span class="kw">color</span>  <span class="kw">=</span> <span class="st">'PM 2.5'</span>
  )

<span class="no">wrfMap</span></pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/wrf_plot-1.png" width="768"></p>
</div>
<div id="bluesky-plotting-example" class="section level2">
<h2 class="hasAnchor">
<a href="#bluesky-plotting-example" class="anchor"></a>BlueSky Plotting Example</h2>
<p>The <code><a href="../../reference/layer_raster.html">layer_raster()</a></code> function can work with Rasters other than those we create through AirFireWRF. For instance, we can also plot BlueSky air quality Rasters from the AirFireModeling package:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">AirFireModeling</span>)

<span class="kw pkg">AirFireModeling</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirFireModeling/man/setModelDataDir.html">setModelDataDir</a></span>(<span class="st">"~/Data/BlueSky"</span>)

<span class="co"># Load BlueSky model run</span>
<span class="no">rasterList</span> <span class="kw">&lt;-</span> <span class="kw pkg">AirFireModeling</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirFireModeling/man/raster_load.html">raster_load</a></span>(
  <span class="kw">modelName</span> <span class="kw">=</span> <span class="st">"PNW-4km"</span>,
  <span class="kw">modelRun</span> <span class="kw">=</span> <span class="fl">2020071500</span>,
  <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
  <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
)

<span class="co"># Extract a single RasterLayer from the BlueSky run RasterBrick</span>
<span class="no">smokeRaster</span> <span class="kw">&lt;-</span> <span class="no">rasterList</span>$<span class="no">`PNW-4km_2020071500`</span>$<span class="no">X1020.07.16.19.00.00</span>

<span class="no">blueskyMap</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span>(
    <span class="kw">colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'green'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>, <span class="st">'maroon'</span>),
    <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">'transparent'</span>
  ) +
  <span class="fu"><a href="../../reference/layer_raster.html">layer_raster</a></span>(
    <span class="kw">raster</span> <span class="kw">=</span> <span class="no">smokeRaster</span>
  ) +
  <span class="fu"><a href="../../reference/layer_states.html">layer_states</a></span>(
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
  ) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>(
    <span class="kw">ratio</span> <span class="kw">=</span> <span class="fl">1.4</span>,
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
  ) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Air QualityMap'</span>,
    <span class="kw">x</span> <span class="kw">=</span> <span class="st">'Longitude'</span>,
    <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Latitude'</span>,
    <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'PM 2.5'</span>
  )

<span class="no">blueskyMap</span></pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/bluesky_plot-1.png" width="768"></p>
<p>It looks like there are a few spots of interest in Washington–particularly around the Tri-cities area with a spot of deep red. Let’s zoom into that region for a better visual and do the following:</p>
<ol style="list-style-type: decimal">
<li>Load and plot a higher resolution BlueSky Raster.</li>
<li>Load and plot the wind Raster again, but this time with a smaller extent.</li>
<li>The air quality raster has a few extremely high outlier values, while most of the rest measure less than 2. For the sake of the color scale, let’s remove the lower-valued cells and cap the high ones at 500.</li>
</ol>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Define a new grid extent</span>
<span class="no">xlim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">120</span>, -<span class="fl">118</span>)
<span class="no">ylim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">46</span>, <span class="fl">47</span>)

<span class="co"># Load model run</span>
<span class="no">rasterList</span> <span class="kw">&lt;-</span> <span class="kw pkg">AirFireModeling</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirFireModeling/man/raster_load.html">raster_load</a></span>(
  <span class="kw">modelName</span> <span class="kw">=</span> <span class="st">"PNW-1.33km"</span>,
  <span class="kw">modelRun</span> <span class="kw">=</span> <span class="fl">2020071500</span>,
  <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
  <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
)

<span class="co"># Extract a single RasterLayer from the BlueSky run RasterBrick</span>
<span class="no">smokeRaster</span> <span class="kw">&lt;-</span> <span class="no">rasterList</span>$<span class="no">`PNW-1.33km_2020071500`</span>$<span class="no">X1020.07.16.19.00.00</span>

<span class="co"># Remove low values and cap high values</span>
<span class="no">smokeRaster</span>[<span class="no">smokeRaster</span> <span class="kw">&lt;</span> <span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fl">NA</span>
<span class="no">smokeRaster</span>[<span class="no">smokeRaster</span> <span class="kw">&gt;</span> <span class="fl">500</span>] <span class="kw">&lt;-</span> <span class="fl">500</span></pre></body></html></div>
<p>Now we can plot this information just like we did for the WRF example:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">blueskyMap</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="co"># Set raster color palette</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span>(
    <span class="kw">colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'green'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>, <span class="st">'maroon'</span>),
    <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">'transparent'</span>
  ) +
  <span class="fu"><a href="../../reference/layer_raster.html">layer_raster</a></span>(
    <span class="kw">raster</span> <span class="kw">=</span> <span class="no">smokeRaster</span>
  ) +
  <span class="fu"><a href="../../reference/layer_states.html">layer_states</a></span>(
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
  ) +
  <span class="co"># Then draw the wind vector field</span>
  <span class="fu"><a href="../../reference/layer_vectorField.html">layer_vectorField</a></span>(
    <span class="kw">raster</span> <span class="kw">=</span> <span class="no">raster</span>,
    <span class="kw">uName</span> <span class="kw">=</span> <span class="st">"U10"</span>,
    <span class="kw">vName</span> <span class="kw">=</span> <span class="st">"V10"</span>,
    <span class="kw">arrowCount</span> <span class="kw">=</span> <span class="fl">500</span>,
    <span class="kw">arrowColor</span> <span class="kw">=</span> <span class="st">'black'</span>,
    <span class="kw">arrowScale</span> <span class="kw">=</span> <span class="fl">0.03</span>,
    <span class="kw">arrowHead</span> <span class="kw">=</span> <span class="fl">0.06</span>,
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
  ) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>(
    <span class="kw">ratio</span> <span class="kw">=</span> <span class="fl">1.4</span>,
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">xlim</span>,
    <span class="kw">ylim</span> <span class="kw">=</span> <span class="no">ylim</span>
  ) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Air Quality &amp; Wind Map'</span>,
    <span class="kw">x</span> <span class="kw">=</span> <span class="st">'Longitude'</span>,
    <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Latitude'</span>,
    <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'Air quality (pm 2.5)'</span>
  )

<span class="no">blueskyMap</span></pre></body></html></div>
<p><img src="Static_Layered_Plots_files/figure-html/bluesky_wind_plot-1.png" width="768"></p>
<p>In the future, this visualization process may be further simplified and include more features specific to meteorological data analysis.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Tate Brasel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
